function WebAudioTinySynth(){this.sy={is:"webaudio-tinysynth",properties:{width:{type:String,value:"256px",observer:"layout"},height:{type:String,value:"64px",observer:"layout"},masterVol:{type:Number,value:.5,observer:"setMasterVol"},reverbLev:{type:Number,value:.3,observer:"setReverbLev"},quality:{type:Number,value:1,observer:"setQuality"},graph:{type:Number,value:1},debug:{type:Number,value:0},src:{type:String,value:null,observer:"loadMIDIUrl"},loop:{type:Number,value:0},disabledrop:{type:Number,value:0},internalcontext:{type:Number,value:1},tsmode:{type:Number,value:0},perfmon:{type:Number,value:0}},layout:function(){this.$["wa-canvas"].style.width=this.width,this.$["wa-canvas"].style.height=this.height},program:[{name:"Acoustic Grand Piano"},{name:"Bright Acoustic Piano"},{name:"Electric Grand Piano"},{name:"Honky-tonk Piano"},{name:"Electric Piano 1"},{name:"Electric Piano 2"},{name:"Harpsichord"},{name:"Clavi"},{name:"Celesta"},{name:"Glockenspiel"},{name:"Music Box"},{name:"Vibraphone"},{name:"Marimba"},{name:"Xylophone"},{name:"Tubular Bells"},{name:"Dulcimer"},{name:"Drawbar Organ"},{name:"Percussive Organ"},{name:"Rock Organ"},{name:"Church Organ"},{name:"Reed Organ"},{name:"Accordion"},{name:"Harmonica"},{name:"Tango Accordion"},{name:"Acoustic Guitar (nylon)"},{name:"Acoustic Guitar (steel)"},{name:"Electric Guitar (jazz)"},{name:"Electric Guitar (clean)"},{name:"Electric Guitar (muted)"},{name:"Overdriven Guitar"},{name:"Distortion Guitar"},{name:"Guitar harmonics"},{name:"Acoustic Bass"},{name:"Electric Bass (finger)"},{name:"Electric Bass (pick)"},{name:"Fretless Bass"},{name:"Slap Bass 1"},{name:"Slap Bass 2"},{name:"Synth Bass 1"},{name:"Synth Bass 2"},{name:"Violin"},{name:"Viola"},{name:"Cello"},{name:"Contrabass"},{name:"Tremolo Strings"},{name:"Pizzicato Strings"},{name:"Orchestral Harp"},{name:"Timpani"},{name:"String Ensemble 1"},{name:"String Ensemble 2"},{name:"SynthStrings 1"},{name:"SynthStrings 2"},{name:"Choir Aahs"},{name:"Voice Oohs"},{name:"Synth Voice"},{name:"Orchestra Hit"},{name:"Trumpet"},{name:"Trombone"},{name:"Tuba"},{name:"Muted Trumpet"},{name:"French Horn"},{name:"Brass Section"},{name:"SynthBrass 1"},{name:"SynthBrass 2"},{name:"Soprano Sax"},{name:"Alto Sax"},{name:"Tenor Sax"},{name:"Baritone Sax"},{name:"Oboe"},{name:"English Horn"},{name:"Bassoon"},{name:"Clarinet"},{name:"Piccolo"},{name:"Flute"},{name:"Recorder"},{name:"Pan Flute"},{name:"Blown Bottle"},{name:"Shakuhachi"},{name:"Whistle"},{name:"Ocarina"},{name:"Lead 1 (square)"},{name:"Lead 2 (sawtooth)"},{name:"Lead 3 (calliope)"},{name:"Lead 4 (chiff)"},{name:"Lead 5 (charang)"},{name:"Lead 6 (voice)"},{name:"Lead 7 (fifths)"},{name:"Lead 8 (bass + lead)"},{name:"Pad 1 (new age)"},{name:"Pad 2 (warm)"},{name:"Pad 3 (polysynth)"},{name:"Pad 4 (choir)"},{name:"Pad 5 (bowed)"},{name:"Pad 6 (metallic)"},{name:"Pad 7 (halo)"},{name:"Pad 8 (sweep)"},{name:"FX 1 (rain)"},{name:"FX 2 (soundtrack)"},{name:"FX 3 (crystal)"},{name:"FX 4 (atmosphere)"},{name:"FX 5 (brightness)"},{name:"FX 6 (goblins)"},{name:"FX 7 (echoes)"},{name:"FX 8 (sci-fi)"},{name:"Sitar"},{name:"Banjo"},{name:"Shamisen"},{name:"Koto"},{name:"Kalimba"},{name:"Bag pipe"},{name:"Fiddle"},{name:"Shanai"},{name:"Tinkle Bell"},{name:"Agogo"},{name:"Steel Drums"},{name:"Woodblock"},{name:"Taiko Drum"},{name:"Melodic Tom"},{name:"Synth Drum"},{name:"Reverse Cymbal"},{name:"Guitar Fret Noise"},{name:"Breath Noise"},{name:"Seashore"},{name:"Bird Tweet"},{name:"Telephone Ring"},{name:"Helicopter"},{name:"Applause"},{name:"Gunshot"}],drummap:[{name:"Acoustic Bass Drum"},{name:"Bass Drum 1"},{name:"Side Stick"},{name:"Acoustic Snare"},{name:"Hand Clap"},{name:"Electric Snare"},{name:"Low Floor Tom"},{name:"Closed Hi Hat"},{name:"High Floor Tom"},{name:"Pedal Hi-Hat"},{name:"Low Tom"},{name:"Open Hi-Hat"},{name:"Low-Mid Tom"},{name:"Hi-Mid Tom"},{name:"Crash Cymbal 1"},{name:"High Tom"},{name:"Ride Cymbal 1"},{name:"Chinese Cymbal"},{name:"Ride Bell"},{name:"Tambourine"},{name:"Splash Cymbal"},{name:"Cowbell"},{name:"Crash Cymbal 2"},{name:"Vibraslap"},{name:"Ride Cymbal 2"},{name:"Hi Bongo"},{name:"Low Bongo"},{name:"Mute Hi Conga"},{name:"Open Hi Conga"},{name:"Low Conga"},{name:"High Timbale"},{name:"Low Timbale"},{name:"High Agogo"},{name:"Low Agogo"},{name:"Cabasa"},{name:"Maracas"},{name:"Short Whistle"},{name:"Long Whistle"},{name:"Short Guiro"},{name:"Long Guiro"},{name:"Claves"},{name:"Hi Wood Block"},{name:"Low Wood Block"},{name:"Mute Cuica"},{name:"Open Cuica"},{name:"Mute Triangle"},{name:"Open Triangle"}],program1:[[{w:"sine",v:.4,d:.7,r:.1},{w:"triangle",v:3,d:.7,s:.1,g:1,a:.01,k:-1.2}],[{w:"triangle",v:.4,d:.7,r:.1},{w:"triangle",v:4,t:3,d:.4,s:.1,g:1,k:-1,a:.01}],[{w:"sine",d:.7,r:.1},{w:"triangle",v:4,f:2,d:.5,s:.5,g:1,k:-1}],[{w:"sine",d:.7,v:.2},{w:"triangle",v:4,t:3,f:2,d:.3,g:1,k:-1,a:.01,s:.5}],[{w:"sine",v:.35,d:.7,b:2},{w:"sine",v:3,t:7,f:1,d:1,s:1,g:1,k:-.7}],[{w:"sine",v:.35,d:.7},{w:"sine",v:11,t:7,f:1,d:.5,s:1,g:1,k:-.7}],[{w:"sawtooth",v:.34,d:2},{w:"sine",v:8,f:.1,d:2,s:1,r:2,g:1}],[{w:"triangle",v:.34,d:1.5},{w:"square",v:6,f:.1,d:1.5,s:.5,r:2,g:1}],[{w:"sine",d:.3,r:.3},{w:"sine",v:7,t:11,d:.03,g:1}],[{w:"sine",d:.3,r:.3},{w:"sine",v:11,t:6,d:.2,s:.4,g:1}],[{w:"sine",v:.2,d:.3,r:.3},{w:"sine",v:11,t:5,d:.1,s:.4,g:1}],[{w:"sine",v:.2,d:.6,r:.6},{w:"triangle",v:11,t:5,f:1,s:.5,g:1}],[{w:"sine",v:.3,d:.2,r:.2},{w:"sine",v:6,t:5,d:.02,g:1}],[{w:"sine",v:.3,d:.2,r:.2},{w:"sine",v:7,t:11,d:.03,g:1}],[{w:"sine",v:.2,d:1,r:1},{w:"sine",v:11,t:3.5,d:1,r:1,g:1}],[{w:"triangle",v:.2,d:.5,r:.2},{w:"sine",v:6,t:2.5,d:.2,s:.1,r:.2,g:1}],[{w:"w9999",v:.3,s:.9},{w:"w9999",v:.3,t:2,f:2,s:.9}],[{w:"w9999",v:.2,s:1},{w:"sine",v:11,t:6,f:2,s:.1,g:1,h:.006,r:.002,d:.002},{w:"w9999",v:.2,t:2,f:1,h:0,s:1}],[{w:"w9999",v:.27,d:.1,s:.9},{w:"w9999",v:.3,t:4,f:2,s:.5}],[{w:"w9999",v:.3,a:.04,s:.9},{w:"w9999",v:.2,t:8,f:2,a:.04,s:.9}],[{w:"sine",v:.2,a:.02,d:.05,s:1},{w:"sine",v:6,t:3,f:1,a:.02,d:.05,s:1,g:1}],[{w:"triangle",v:.2,a:.02,d:.05,s:.8},{w:"square",v:7,t:3,f:1,d:.05,s:1.5,g:1}],[{w:"square",v:.2,a:.02,d:.2,s:.5},{w:"square",v:1,d:.03,s:2,g:1}],[{w:"square",v:.2,a:.02,d:.1,s:.8},{w:"square",v:1,a:.3,d:.1,s:2,g:1}],[{w:"triangle",v:.3,d:.5},{w:"triangle",v:5,t:3,f:1.5,d:1,s:.1,g:1}],[{w:"triangle",v:.4,d:.6},{w:"triangle",v:8,t:1.001,d:1,s:1,g:1}],[{w:"triangle",v:.3,d:1},{w:"triangle",v:6,f:2,d:.4,s:.5,g:1}],[{w:"sine",v:.3,d:1},{w:"triangle",v:6,f:1,d:.4,s:.5,g:1}],[{w:"sine",v:.4,d:.1},{w:"sine",v:7,g:1}],[{w:"triangle",v:.3,d:1},{w:"square",v:7,f:2,d:.3,s:.5,g:1}],[{w:"triangle",v:.4,d:1},{w:"square",v:4,f:2,d:1,s:.7,g:1}],[{w:"sine",v:.2,t:1.5,a:.005,h:.2,d:.6},{w:"sine",v:11,t:5,f:2,d:1,s:.5,g:1}],[{w:"sine",d:.3},{w:"sine",v:4,t:3,d:1,s:1,g:1}],[{w:"sine",d:.3},{w:"sine",v:4,t:3,d:1,s:1,g:1}],[{w:"w9999",d:.3,v:.7,s:.5},{w:"sawtooth",v:1.2,d:.02,s:.5,g:1,h:0,r:.02}],[{w:"sine",d:.3},{w:"sine",v:4,t:3,d:1,s:1,g:1}],[{w:"triangle",v:.3,t:2,d:1},{w:"triangle",v:15,t:2.5,d:.04,s:.1,g:1}],[{w:"triangle",v:.3,t:2,d:1},{w:"triangle",v:15,t:2.5,d:.04,s:.1,g:1}],[{w:"triangle",d:.7},{w:"square",v:.4,t:.5,f:1,d:.2,s:10,g:1}],[{w:"triangle",d:.7},{w:"square",v:.4,t:.5,f:1,d:.2,s:10,g:1}],[{w:"sawtooth",v:.4,a:.1,d:11},{w:"sine",v:5,d:11,s:.2,g:1}],[{w:"sawtooth",v:.4,a:.1,d:11},{w:"sine",v:5,d:11,s:.2,g:1}],[{w:"sawtooth",v:.4,a:.1,d:11},{w:"sine",v:5,t:.5,d:11,s:.2,g:1}],[{w:"sawtooth",v:.4,a:.1,d:11},{w:"sine",v:5,t:.5,d:11,s:.2,g:1}],[{w:"sine",v:.4,a:.1,d:11},{w:"sine",v:6,f:2.5,d:.05,s:1.1,g:1}],[{w:"sine",v:.3,d:.1,r:.1},{w:"square",v:4,t:3,d:1,s:.2,g:1}],[{w:"sine",v:.3,d:.5,r:.5},{w:"sine",v:7,t:2,f:2,d:1,r:1,g:1}],[{w:"triangle",v:.6,h:.03,d:.1,r:.1,p:.8},{w:"sine",v:4,t:3,d:.08,r:.08,p:.8,g:1}],[{w:"sawtooth",v:.3,a:.03,s:.5},{w:"sawtooth",v:.2,t:2,f:2,d:1,s:2}],[{w:"sawtooth",v:.3,f:-2,a:.03,s:.5},{w:"sawtooth",v:.2,t:2,f:2,d:1,s:2}],[{w:"sawtooth",v:.2,a:.02,s:1},{w:"sawtooth",v:.2,t:2,f:2,a:1,d:1,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1},{w:"sawtooth",v:.2,f:2,a:.02,d:1,s:1}],[{w:"triangle",v:.3,a:.03,s:1},{w:"sine",v:3,t:5,f:1,d:1,s:1,g:1}],[{w:"sine",v:.4,a:.03,s:.9},{w:"sine",v:1,t:2,f:3,d:.03,s:.2,g:1}],[{w:"triangle",v:.6,a:.05,s:.5},{w:"sine",v:1,f:.8,d:.2,s:.2,g:1}],[{w:"square",v:.15,a:.01,d:.2,r:.2,t:.5,c:0,h:.03},{w:"square",v:4,f:.5,d:.2,r:11,a:.01,g:1,c:0,h:.02},{w:"square",v:.15,t:4,f:1,a:.02,d:.15,r:.15,c:0,h:.03},{g:3,w:"square",v:4,f:-.5,a:.01,h:.02,d:.15,s:0,r:11,c:0,p:1,k:0}],[{w:"square",v:.2,a:.01,d:1,s:.6,r:.04},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.5,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.04,d:1,s:.4,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.15,a:.04,s:1},{w:"sine",v:2,d:.1,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.5,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.6,r:.08},{w:"sine",v:1,f:.2,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:.5,s:.7,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.5,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:2,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"square",v:.2,a:.02,d:2,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"sine",v:.4,a:.02,d:.7,s:.5},{w:"square",v:5,t:2,d:.2,s:.5,g:1}],[{w:"sine",v:.3,a:.05,d:.2,s:.8},{w:"sawtooth",v:6,f:.1,d:.1,s:.3,g:1}],[{w:"sine",v:.3,a:.03,d:.2,s:.4},{w:"square",v:7,f:.2,d:1,s:.1,g:1}],[{w:"square",v:.2,a:.05,d:.1,s:.8},{w:"square",v:4,d:.1,s:1.1,g:1}],[{w:"sine",a:.02,d:2},{w:"sine",v:6,t:2,d:.04,g:1}],[{w:"sine",v:.7,a:.03,d:.4,s:.4},{w:"sine",v:4,t:2,f:.2,d:.4,g:1}],[{w:"sine",v:.7,a:.02,d:.4,s:.6},{w:"sine",v:3,t:2,d:.05,s:.1,g:1}],[{w:"sine",v:.4,a:.06,d:.3,s:.3},{w:"sine",v:7,t:2,d:.2,s:.2,g:1}],[{w:"sine",a:.02,d:.3,s:.3},{w:"sawtooth",v:3,t:2,d:.3,g:1}],[{w:"sine",v:.4,a:.02,d:2,s:.1},{w:"sawtooth",v:8,t:2,f:1,d:.5,g:1}],[{w:"sine",v:.7,a:.03,d:.5,s:.3},{w:"sine",v:.003,t:0,f:4,d:.1,s:.002,g:1}],[{w:"sine",v:.7,a:.02,d:2},{w:"sine",v:1,t:2,f:1,d:.02,g:1}],[{w:"square",v:.3,d:1,s:.5},{w:"square",v:1,f:.2,d:1,s:.5,g:1}],[{w:"sawtooth",v:.3,d:2,s:.5},{w:"square",v:2,f:.1,s:.5,g:1}],[{w:"triangle",v:.5,a:.05,d:2,s:.6},{w:"sine",v:4,t:2,g:1}],[{w:"triangle",v:.3,a:.01,d:2,s:.3},{w:"sine",v:22,t:2,f:1,d:.03,s:.2,g:1}],[{w:"sawtooth",v:.3,d:1,s:.5},{w:"sine",v:11,t:11,a:.2,d:.05,s:.3,g:1}],[{w:"sine",v:.3,a:.06,d:1,s:.5},{w:"sine",v:7,f:1,d:1,s:.2,g:1}],[{w:"sawtooth",v:.3,a:.02,d:.2,s:.7,r:.08},{w:"sawtooth",v:.3,t:.75,f:2,a:.02,d:.2,s:.5,r:.08}],[{w:"triangle",v:.3,a:.01,d:.7,s:.5},{w:"square",v:5,t:.5,d:.7,s:.5,g:1}],[{w:"triangle",v:.3,a:.02,d:.3,s:.3,r:.3},{w:"square",v:3,t:4,f:1,a:.02,d:.1,s:1,g:1}],[{w:"triangle",v:.3,a:.05,d:1,s:.7,r:.3},{w:"sawtooth",v:3,t:4,f:1,d:.3,s:1,g:1}],[{w:"square",v:.3,a:.03,d:.5,s:.3,r:.1},{w:"square",v:4,f:1,a:.03,d:.1,g:1}],[{w:"triangle",v:.3,a:.08,d:1,s:.3,r:.1},{w:"square",v:3,f:1,d:.3,s:.3,g:1}],[{w:"sine",v:.3,a:.05,d:1,s:.3,r:.1},{w:"sine",v:.1,t:2.001,f:1,d:1,s:50,g:1}],[{w:"triangle",v:.3,a:.03,d:.7,s:.3,r:.2},{w:"sine",v:12,t:7,f:1,d:.5,s:1.7,g:1}],[{w:"sine",v:.3,a:.05,d:1,s:.3,r:.1},{w:"sawtooth",v:22,t:6,d:.06,s:.3,g:1}],[{w:"triangle",v:.3,a:.05,d:11,r:.3},{w:"triangle",v:1,d:1,s:8,g:1}],[{w:"sawtooth",v:.3,d:4,s:.8,r:.1},{w:"square",v:1,t:2,f:8,a:1,d:1,s:1,r:.1,g:1}],[{w:"triangle",v:.3,d:1,s:.5},{w:"triangle",v:11,f:1,a:1,d:.3,s:1,g:1}],[{w:"sine",v:.3,d:1,s:.3},{w:"square",v:22,t:11,d:.5,s:.1,g:1}],[{w:"sawtooth",v:.3,a:.04,d:1,s:.8,r:.1},{w:"square",v:1,t:.5,d:1,s:2,g:1}],[{w:"triangle",v:.3,d:1,s:.3},{w:"sine",v:22,t:6,d:.6,s:.05,g:1}],[{w:"sine",v:.6,a:.1,d:.05,s:.4},{w:"sine",v:5,t:5,f:1,d:.05,s:.3,g:1}],[{w:"sine",a:.1,d:.05,s:.4},{w:"sine",v:5,t:5,f:1,d:.05,s:.3,g:1}],[{w:"square",v:.3,a:.1,d:.1,s:.4},{w:"square",v:1,f:1,d:.3,s:.1,g:1}],[{w:"sawtooth",v:.3,d:.5,r:.5},{w:"sawtooth",v:11,t:5,d:.05,g:1}],[{w:"square",v:.3,d:.2,r:.2},{w:"square",v:7,t:3,d:.05,g:1}],[{w:"triangle",d:.2,r:.2},{w:"square",v:9,t:3,d:.1,r:.1,g:1}],[{w:"triangle",d:.3,r:.3},{w:"square",v:6,t:3,d:1,r:1,g:1}],[{w:"triangle",v:.4,d:.2,r:.2},{w:"square",v:22,t:12,d:.1,r:.1,g:1}],[{w:"sine",v:.25,a:.02,d:.05,s:.8},{w:"square",v:1,t:2,d:.03,s:11,g:1}],[{w:"sine",v:.3,a:.05,d:11},{w:"square",v:7,t:3,f:1,s:.7,g:1}],[{w:"square",v:.3,a:.05,d:.1,s:.8},{w:"square",v:4,d:.1,s:1.1,g:1}],[{w:"sine",v:.4,d:.3,r:.3},{w:"sine",v:7,t:9,d:.1,r:.1,g:1}],[{w:"sine",v:.7,d:.1,r:.1},{w:"sine",v:22,t:7,d:.05,g:1}],[{w:"sine",v:.6,d:.15,r:.15},{w:"square",v:11,t:3.2,d:.1,r:.1,g:1}],[{w:"sine",v:.8,d:.07,r:.07},{w:"square",v:11,t:7,r:.01,g:1}],[{w:"sine",v:.7,t:.5,d:.2,r:.2,p:.95},{w:"square",v:14,t:2,g:1}],[{w:"sine",v:.7,d:.1,r:.1,p:.9},{w:"square",v:14,t:2,d:.005,r:.005,g:1}],[{w:"square",d:.15,r:.15,p:.5},{w:"square",v:4,t:5,d:.001,r:.001,g:1}],[{w:"square",v:.1,a:1,s:1,d:.15,r:.15,p:1},{w:"sine",v:17,t:15,a:.1,d:1,s:1,r:.07,g:1},{w:"sine",v:11,t:11,a:.1,b:3123,d:1,s:1,r:.07,g:1}],[{w:"triangle",t:0,f:1732,d:.2,r:.001,b:923,p:1.3}],[{w:"triangle",v:.2,a:.05,h:.02,d:.02,r:.02,b:3266}],[{w:"sine",v:.3,a:1,d:1,b:2305}],[{w:"sine",v:.3,a:.01,d:1,s:.5},{w:"sawtooth",v:6,t:0,f:12,d:1,s:1,r:.1,b:14,g:1}],[{w:"square",v:.3,t:.25,d:11,s:1},{w:"square",v:12,t:0,f:8,d:1,s:1,r:11,g:1}],[{w:"sine",v:.4,t:0,f:500,a:1,d:11,s:1,r:.5,b:1133},{w:"square",v:2,t:0,f:14,d:1,s:1,r:11,g:1}],[{w:"triangle",t:0,f:1221,a:.2,d:11,r:.5,b:1782}],[{w:"square",d:.4,r:.4,p:.7},{w:"sine",v:7,t:1.3,d:1,r:1,b:1224,g:1}]],program0:[[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"sawtooth",v:.3,d:.7}],[{w:"sawtooth",v:.3,d:.7}],[{w:"sine",v:.5,d:.3,r:.3}],[{w:"triangle",v:.5,d:.3,r:.3}],[{w:"square",v:.2,d:.3,r:.3}],[{w:"square",v:.2,d:.3,r:.3}],[{w:"sine",v:.5,d:.1,r:.1}],[{w:"sine",v:.5,d:.1,r:.1}],[{w:"square",v:.2,d:1,r:1}],[{w:"sawtooth",v:.3,d:.7,r:.7}],[{w:"sine",v:.5,a:.01,s:1}],[{w:"sine",v:.7,d:.02,s:.7}],[{w:"square",v:.2,s:1}],[{w:"triangle",v:.5,a:.01,s:1}],[{w:"square",v:.2,a:.02,s:1}],[{w:"square",v:.2,a:.02,s:1}],[{w:"square",v:.2,a:.02,s:1}],[{w:"square",v:.2,a:.05,s:1}],[{w:"triangle",v:.5,d:.5}],[{w:"square",v:.2,d:.6}],[{w:"square",v:.2,d:.6}],[{w:"triangle",v:.8,d:.6}],[{w:"triangle",v:.4,d:.05}],[{w:"square",v:.2,d:1}],[{w:"square",v:.2,d:1}],[{w:"sine",v:.4,d:.6}],[{w:"triangle",v:.7,d:.4}],[{w:"triangle",v:.7,d:.7}],[{w:"triangle",v:.7,d:.7}],[{w:"triangle",v:.7,d:.7}],[{w:"square",v:.3,d:.2}],[{w:"square",v:.3,d:.2}],[{w:"square",v:.3,d:.1,s:.2}],[{w:"sawtooth",v:.4,d:.1,s:.2}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.3,d:.1}],[{w:"sawtooth",v:.3,d:.5,r:.5}],[{w:"triangle",v:.6,d:.1,r:.1,h:.03,p:.8}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"triangle",v:.3,a:.03,s:1}],[{w:"sine",v:.3,a:.03,s:1}],[{w:"triangle",v:.3,a:.05,s:1}],[{w:"sawtooth",v:.5,a:.01,d:.1}],[{w:"square",v:.3,a:.1,d:.2,s:.6}],[{w:"square",v:.3,a:.1,d:.2,s:.6}],[{w:"square",v:.3,a:.1,d:.2,s:.6}],[{w:"square",v:.2,a:.1,d:.01,s:1}],[{w:"square",v:.3,a:.05,s:1}],[{w:"square",v:.3,s:.7}],[{w:"square",v:.3,s:.7}],[{w:"square",v:.3,s:.7}],[{w:"square",v:.3,a:.02,d:2}],[{w:"square",v:.3,a:.02,d:2}],[{w:"square",v:.3,a:.03,d:2}],[{w:"square",v:.3,a:.04,d:2}],[{w:"square",v:.3,a:.02,d:2}],[{w:"square",v:.3,a:.05,d:2}],[{w:"square",v:.3,a:.03,d:2}],[{w:"square",v:.3,a:.03,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"square",v:.3,s:.7}],[{w:"sawtooth",v:.4,s:.7}],[{w:"triangle",v:.5,s:.7}],[{w:"sawtooth",v:.4,s:.7}],[{w:"sawtooth",v:.4,d:12}],[{w:"sine",v:.4,a:.06,d:12}],[{w:"sawtooth",v:.4,d:12}],[{w:"sawtooth",v:.4,d:12}],[{w:"sawtooth",v:.3,d:12}],[{w:"triangle",v:.5,d:12}],[{w:"square",v:.3,d:12}],[{w:"triangle",v:.5,a:.08,d:11}],[{w:"sawtooth",v:.5,a:.05,d:11}],[{w:"sawtooth",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"square",v:.3,d:11}],[{w:"sawtooth",v:.5,a:.04,d:11}],[{w:"sawtooth",v:.5,d:11}],[{w:"triangle",v:.5,a:.8,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"square",v:.3,d:11}],[{w:"sawtooth",v:.3,d:1,r:1}],[{w:"sawtooth",v:.5,d:.3}],[{w:"sawtooth",v:.5,d:.3,r:.3}],[{w:"sawtooth",v:.5,d:.3,r:.3}],[{w:"square",v:.3,d:.2,r:.2}],[{w:"square",v:.3,a:.02,d:2}],[{w:"sawtooth",v:.2,a:.02,d:.7}],[{w:"triangle",v:.5,d:1}],[{w:"sawtooth",v:.3,d:.3,r:.3}],[{w:"sine",v:.8,d:.1,r:.1}],[{w:"square",v:.2,d:.1,r:.1,p:1.05}],[{w:"sine",v:.8,d:.05,r:.05}],[{w:"triangle",v:.5,d:.1,r:.1,p:.96}],[{w:"triangle",v:.5,d:.1,r:.1,p:.97}],[{w:"square",v:.3,d:.1,r:.1,p:.1}],[{w:"square",v:.3,a:1,d:.01,r:.01,b:3532,p:1.2}],[{w:"triangle",v:.5,d:.03,t:0,f:1332,r:.001,b:823,p:1.1}],[{w:"triangle",v:.2,b:3266,d:.02,a:.05,h:.02,r:.02}],[{w:"sine",v:.3,a:1,b:2305,d:1}],[{w:"sine",v:.3,a:.8,b:942,d:1,t:0,f:1832}],[{w:"triangle",v:.5,d:.5,t:0,f:864,b:778}],[{w:"sine",v:.4,d:11,t:0,f:500,b:590}],[{w:"triangle",v:.5,a:.2,b:1782,d:11,t:0,f:1221}],[{w:"triangle",v:.5,b:2200,d:.4,r:.4}]],drummap1:[[{w:"triangle",t:0,f:66,v:2,d:.02,h:.03,p:.9,r:.02},{w:"square",g:1,t:10.1,v:22,r:.002,c:0,h:0,p:0,d:.002}],[{w:"triangle",t:0,f:66,v:2,d:.02,h:.03,p:.9,r:.02},{w:"square",g:1,t:10.1,v:22,r:.002,c:0,h:0,p:0,d:.002}],[{w:"square",f:222,p:0,b:4222,t:0,r:.01,h:0}],[{w:"sine",f:191,v:.5,d:.03,p:.9,t:0,r:.03,h:.03},{w:"square",v:.6,t:0,f:722,h:.015,r:.01,b:3323,c:0,p:0}],[{w:"square",f:1150,v:.34,t:0,r:.03,h:.025,d:.03,p:.98},{g:1,w:"sine",t:0,f:231,h:.05,d:.1,s:1,r:.1,b:1253,c:0}],[{w:"triangle",f:232,v:1,d:.06,p:.7,t:0,r:.06},{w:"square",g:1,t:0,f:1121,v:12,r:.01,b:2551,c:0,h:.015}],[{w:"triangle",f:200,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"square",v:5,t:3,h:.015,d:.005,r:.005,b:2551,c:0}],null,[{w:"triangle",f:200,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"square",v:5,t:3,h:.015,d:.005,r:.005,b:2551,c:0}],[{w:"square",v:.4,f:622,b:1142,r:.03,t:0,h:.005,d:.03}],[{w:"triangle",f:250,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"square",v:5,t:3,h:.015,d:.005,r:.005,b:2551,c:0}],[{w:"square",v:.4,f:622,t:0,h:0,d:.05},{w:"square",g:1,v:4,h:0,d:.5,r:1,b:1142,c:0}],[{w:"triangle",f:320,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"square",v:5,t:3,h:.015,d:.005,r:.005,b:2551,c:0}],[{w:"triangle",f:360,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"square",v:5,t:3,h:.015,d:.005,r:.005,b:2551,c:0}],[{w:"square",f:720,v:.3,d:.22,r:.22,h:.05,t:0,p:1.2},{w:"square",g:1,t:1.75,v:3.8,d:.22,s:1.2,r:.22,b:1551,c:0,h:.05,a:.1}],[{w:"triangle",f:420,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"square",v:5,t:3,h:.015,d:.005,r:.005,b:2551,c:0}],[{w:"sine",f:1651,v:.15,d:.4,r:.4,h:0,t:0,c:0},{w:"sawtooth",g:1,t:1.21,v:7.2,d:.1,r:11,c:0,h:1},{g:1,w:"square",v:3.1,t:1.52,r:.01,b:55,c:0}],[{w:"sine",f:1600,v:.3,d:.17,r:.17,h:.05,t:0,p:1.5},{w:"sine",g:1,t:1.7,v:2,d:.3,s:1,r:.3,p:2,b:1800,c:0}],[{w:"sine",f:1651,v:.15,d:.2,r:.2,h:0,t:0,c:0},{w:"sawtooth",g:1,t:1.21,v:7.2,d:.1,r:11,c:0,h:1},{g:1,w:"square",v:3.1,t:1.52,d:.002,r:.002,b:1222,c:0}],null,[{w:"sine",f:2100,v:.3,d:.12,r:.12,h:.05,t:0},{w:"sine",g:1,v:1,d:.1,s:1,r:.1,p:1.2,b:2121,c:0}],null,[{w:"sine",f:1700,v:.3,d:.15,r:.15,h:.05,t:0,p:.7},{w:"sine",g:1,t:1.2,v:1,d:.1,s:1,r:.1,p:2,b:2231,c:0}],null,[{w:"sine",f:1651,v:.15,d:.4,r:.4,h:0,t:0,c:0},{w:"sawtooth",g:1,t:1.21,v:7.2,d:.1,r:11,c:0,h:1},{g:1,w:"square",v:3.1,t:1.52,r:.01,b:55,c:0}],null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,[{w:"sine",f:1720,v:.3,d:.02,t:0,r:.02},{w:"square",g:1,t:0,f:2876,v:6,d:.2,s:1,r:.2,c:0}],[{w:"sine",f:1720,v:.3,d:.25,t:0,r:.25},{w:"square",g:1,t:0,f:2876,v:6,d:.2,s:1,r:.2,c:0}]],drummap0:[[{w:"triangle",t:0,f:150,v:.8,d:.1,p:.1,h:.02,r:.01,b:0}],[{w:"triangle",t:0,f:110,v:1,d:.05,r:.05,h:.02,p:.1,b:1}],[{w:"triangle",f:392,v:.5,d:.01,p:0,b:2343,t:0,r:.05}],[{w:"triangle",f:322,v:.5,d:.05,p:.2,b:1200,t:0,r:.05}],[{w:"triangle",f:244,v:.7,d:.03,b:2231,t:0,r:.03}],[{w:"square",f:310,v:.7,d:.02,p:.1,b:20}],[{w:"triangle",f:150,v:.9,d:.1,h:.02,p:.1,b:10}],[{w:"square",f:1250,v:.2,d:.01,b:8423,r:.01}],[{w:"triangle",f:210,v:.9,d:.1,h:.02,p:.1,b:11}],[{w:"square",f:250,v:.2,d:.03,b:8423,r:.03}],[{w:"triangle",f:260,v:.9,d:.1,h:.001,p:.1,b:10}],[{w:"square",f:1250,v:.2,d:.05,b:8423,r:.01,h:.02}],[{w:"triangle",f:320,v:.9,d:.1,h:.001,p:.1,b:10}],[{w:"triangle",f:360,v:.9,d:.1,h:.001,p:.1,b:10}],[{w:"square",f:150,v:.2,d:.1,b:2823,r:.1,h:.05,t:0,p:.1}],[{w:"triangle",f:400,v:.9,d:.1,h:.001,p:.1,b:10}],[{w:"square",f:150,v:.2,d:.1,b:2823,r:.01,h:.05,t:0,p:.1}],[{w:"square",f:150,v:.2,d:.1,b:2823,r:.01,h:.05,t:0,p:.1}],[{w:"triangle",f:900,v:.3,d:.14,p:.9,b:4e3}],[{w:"square",f:800,v:.2,d:.05,p:.9,b:700}],[{w:"square",f:1200,v:.3,d:.12,p:.9,b:3322,s:0}],[{w:"sine",f:600,v:.4,d:.06}],[{w:"square",f:150,v:.2,d:.1,b:2823,r:.01,h:.05,t:0,p:.1}],[{w:"square",f:800,v:.3,d:.2,p:.9,b:844,t:0}],[{w:"triangle",f:500,v:.3,d:.14,p:.9,b:4e3}],[{w:"sine",f:200,v:.5,d:.06}],[{w:"sine",f:150,v:.5,d:.06}],[{w:"sine",f:300,v:.5,d:.01}],[{w:"sine",f:300,v:.5,d:.06}],[{w:"sine",f:250,v:.5,d:.06}],[{w:"square",f:300,v:.3,d:.06,p:.8,b:23}],[{w:"square",f:260,v:.3,d:.06,p:.8,b:43}],[{w:"sine",f:850,v:.5,d:.07}],[{w:"sine",f:790,v:.5,d:.07}],[{w:"sine",f:920,v:.3,a:.05,d:.01,b:1700}],[{w:"sawtooth",f:1120,v:.3,a:.05,d:.01,b:2700}],[{w:"square",f:1800,v:.3,d:.01,p:.9,b:820,t:0,h:.03}],[{w:"square",f:1800,v:.3,d:.01,p:.9,b:820,t:0,h:.13}],[{w:"sine",f:920,v:.3,a:.02,d:.01,b:1700}],[{w:"sine",f:920,v:.3,a:.02,d:.04,b:1700}],[{w:"square",f:1450,v:.3,d:.01,b:2400}],[{w:"sine",f:650,v:.5,d:.01}],[{w:"sine",f:550,v:.5,d:.01}],[{w:"square",f:550,v:.3,d:.01,b:300}],[{w:"square",f:550,v:.3,b:300,t:0,h:.1,r:.01,p:.7}],[{w:"sine",t:0,f:1200,v:.3,r:.01}],[{w:"sine",t:0,f:1200,v:.3,d:.2,r:.2}]],ready:function(){this.pg=[],this.vol=[],this.ex=[],this.bend=[],this.rpnidx=[],this.brange=[],this.sustain=[],this.notetab=[],this.maxTick=0,this.playTick=0,this.playing=0,this.$&&this.$["wa-canvas"]&&(this.canvas=this.$["wa-canvas"],this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,256,64),this.t0=this.t1=this.t2=this.t3=performance.now(),this.ratio=this.pcnt=0),this.preroll=.2,this.relcnt=0,setInterval(function(){if(++this.relcnt>=3){this.relcnt=0;for(var a=this.notetab.length-1;a>=0;--a){var b=this.notetab[a];if(this.actx.currentTime>b.e){for(var c=b.o.length-1;c>=0;--c){try{this.chmod[b.ch].disconnect(b.o[c].detune)}catch(a){}b.o[c].disconnect(),b.o[c].frequency.cancelScheduledValues(0),b.o[c].stop(0)}for(var c=b.g.length-1;c>=0;--c)b.g[c].disconnect(),b.g[c].gain.cancelScheduledValues(0);this.notetab.splice(a,1)}}}if(this.t0=this.t1,this.t1=performance.now(),this.canvas){if(this.ana){var d=new Uint8Array(256);this.ana.getByteTimeDomainData(d),this.ctx.globalCompositeOperation="lighter",this.ctx.fillStyle="#0f0";for(var a=0;a<256;++a){var e=d[a];this.ctx.fillRect(a,(e-128>>1)+32,1,1)}}this.ctx.globalCompositeOperation="source-over",this.ctx.fillStyle="rgba(0,0,0,0.05)",this.ctx.fillRect(0,0,256,64),this.song&&(this.ctx.fillStyle="#036",this.ctx.fillRect(180,10,50,45),this.ctx.fillStyle="#fff",this.playing?(this.ctx.fillRect(190,22,10,20),this.ctx.fillRect(210,22,10,20)):(this.ctx.beginPath(),this.ctx.moveTo(220,32),this.ctx.lineTo(200,42),this.ctx.lineTo(200,22),this.ctx.fill()))}if(this.playing&&this.song.ev.length>0)for(var f=this.song.ev[this.playIndex];this.actx.currentTime+this.preroll>this.playTime;)if(65361==f.m[0]?(this.song.tempo=f.m[1],this.tick2Time=240/this.song.tempo/this.song.timebase):this.send(f.m,this.playTime),++this.playIndex,this.playIndex>=this.song.ev.length){if(!this.loop){this.playTick=this.maxTick,this.playing=0;break}f=this.song.ev[this.playIndex=0],this.playTick=f.t}else f=this.song.ev[this.playIndex],this.playTime+=(f.t-this.playTick)*this.tick2Time,this.playTick=f.t;this.canvas&&this.perfmon&&(this.t2=this.t3,this.t3=performance.now(),this.ratio=.95*this.ratio+(this.t2-this.t0)/(this.t1-this.t0)*.05,++this.pcnt>10&&(this.pcnt=0,this.ctx.fillStyle="#000",this.ctx.clearRect(0,64,40,-18),this.ctx.fillStyle="#000",this.ctx.fillText(this.notetab.length,4,59)))}.bind(this),60),this.canvas&&(this.canvas.addEventListener("dragover",this.dragOver.bind(this),!1),this.canvas.addEventListener("drop",this.execDrop.bind(this),!1),this.canvas.addEventListener("click",this.click.bind(this),!1)),console.log("internalcontext:"+this.internalcontext),this.internalcontext&&this.setAudioContext(new AudioContext),this.isReady=1},setMasterVol:function(a){void 0!=a&&(this.masterVol=a),this.out&&(this.out.gain.value=this.masterVol)},setReverbLev:function(a){void 0!=a&&(this.reverbLev=a);var b=parseFloat(this.reverbLev);this.rev&&!isNaN(b)&&(this.rev.gain.value=8*b)},setLoop:function(a){this.loop=a},getPlayStatus:function(){return{play:this.playing,maxTick:this.maxTick,curTick:this.playTick}},click:function(a){this.playing?this.stopMIDI():this.song&&this.playMIDI()},dragOver:function(a){a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"},execDrop:function(a){var b=a.dataTransfer.files;if(0==this.disabledrop){var c=new FileReader;c.onload=function(a){this.loadMIDI(c.result)}.bind(this),c.readAsArrayBuffer(b[0])}a.stopPropagation(),a.preventDefault()},getTimbreName:function(a,b){return 0==a?this.program[b].name:this.drummap[b-35].name},loadMIDIUrl:function(a){if(a){var b=new XMLHttpRequest;b.open("GET",a,!0),b.responseType="arraybuffer",b.loadMIDI=this.loadMIDI.bind(this),b.onload=function(a){200==this.status&&this.loadMIDI(this.response)},b.send()}},reset:function(){for(var a=0;a<16;++a)this.send([176+a,120,0],0),this.send([176+a,121,0],0)},stopMIDI:function(){this.playing=0,this.reset(),this.releaseAllNote()},playMIDI:function(){this.reset(),this.song&&(this.playTick=0,this.playIndex=0,this.playTime=this.actx.currentTime+.1,this.tick2Time=240/this.song.tempo/this.song.timebase,this.playing=1)},loadMIDI:function(a){function b(a,b){return(a[b]<<8)+a[b+1]}function c(a,b){return(a[b]<<16)+(a[b+1]<<8)+a[b+2]}function d(a,b){return(a[b]<<24)+(a[b+1]<<16)+(a[b+2]<<8)+a[b+3]}function e(a,b,c){return String.fromCharCode.apply(null,a.slice(b,b+c))}function f(a,b){var c,d;for(c=0,i=1;128&(d=a[b]);)c=(c<<7)+(127&d),++i,++b;return(c<<7)+d}function g(a,b,d,g){var h=d[g];switch(i=1,0==(128&h)&&(h=k,i=0),k=h,240&h){case 192:case 208:a.ev.push({t:b,m:[h,d[g+i]]}),i+=1;break;case 240:switch(h){case 255:var l=f(d,g+2);switch(j=2+i,i=l+i+2,d[g+1]){case 2:a.copyright+=e(d,g+j,i-3);break;case 1:case 3:case 4:case 9:a.text=e(d,g+j,i-j);break;case 47:return 1;case 81:var m=Math.floor(6e7/c(d,g+3));a.ev.push({t:b,m:[65361,m]})}}break;default:a.ev.push({t:b,m:[h,d[g+i],d[g+i+1]]}),i+=2}return 0}this.stopMIDI();var h=new Uint8Array(a),i=0,j=0,k=144,l=0,m=h.slice(0,4);if("77,84,104,100"==m.toString()){var n=d(h,4),o=(b(h,8),b(h,10));this.maxTick=0;var p=4*b(h,12);for(l=n+8,this.song={copyright:"",text:"",tempo:120,timebase:p,ev:[]},tr=0;tr<o;++tr){if(m=h.slice(l,l+4),n=d(h,l+4),"77,84,114,107"==m.toString()){var q=0,r=0;for(this.notetab.length=0;;){q+=f(h,l+8+r),r+=i;var s=g(this.song,q,h,l+8+r);if(r+=i,s)break}q>this.maxTick&&(this.maxTick=q)}l+=n+8}this.song.ev.sort(function(a,b){return a.t-b.t})}},setQuality:function(a){function b(a){for(e=0;e<a.length;++e)for(d in f)a[e].hasOwnProperty(d)&&"undefined"!=typeof a[e][d]||(a[e][d]=f[d]);return a}var c,d,e,f={g:0,w:"sine",t:1,f:0,v:.5,a:0,h:.01,d:.01,s:0,r:.05,p:1,b:0,c:2,k:0};for(void 0!=a&&(this.quality=a),c=0;c<128;++c)this.program[c].p=b(this.program0[c]);for(c=0;c<this.drummap0.length;++c)this.drummap[c].p=b(this.drummap0[c]);if(this.quality){for(c=0;c<this.program1.length;++c)this.program[c].p=b(this.program1[c]);for(c=0;c<this.drummap.length;++c)this.drummap1[c]&&(this.drummap[c].p=b(this.drummap1[c]))}},note:function(a,b,c,d,e){var f,g,h,i=[],j=[],k=[],l=[],m=[],n=440*Math.pow(2,(c-69)/12);for(f=this.notetab.length-1;f>=0;--f){var o=this.notetab[f];o.ch==b&&o.n==c&&(o.e=a,o.f=1)}for(f=0;f<e.length;++f){pn=e[f],i[f]=this.actx.createOscillator(),j[f]=this.actx.createGain();var p=a+pn.a+pn.h;if(m[f]=pn.r,0==pn.g?(g=this.chvol[b],h=d*d/16384,l[f]=n*pn.t+pn.f):(g=i[pn.g-1].frequency,h=l[pn.g-1],l[f]=l[pn.g-1]*pn.t+pn.f),"w"==pn.w[0]?i[f].setPeriodicWave(this.wave[pn.w]):i[f].type=pn.w,this.chmod[b].connect(i[f].detune),i[f].detune.value=this.bend[b],i[f].frequency.value=l[f],i[f].connect(j[f]),j[f].connect(g),k[f]=h*pn.v,pn.k&&(k[f]*=Math.pow(2,(c-60)/12*pn.k)),pn.a?(j[f].gain.value=0,j[f].gain.setValueAtTime(0,a),j[f].gain.linearRampToValueAtTime(k[f],a+pn.a)):j[f].gain.setValueAtTime(k[f],a),this.setParamTarget(j[f].gain,pn.s*k[f],p,pn.d),pn.b){var q=this.actx.createGain(),r=this.actx.createDelay(256/this.actx.sampleRate);i[f].connect(q),q.gain.setValueAtTime(pn.b,a),q.connect(r),r.connect(i[f].frequency)}1!=pn.p&&this.setParamTarget(i[f].frequency,l[f]*pn.p,p,pn.d),i[f].start(a)}this.notetab.push({t:a,e:9==b?a+10*e[0].d:99999,ch:b,n:c,o:i,g:j,t2:a,v:k,r:m,f:9==b?1:0})},setParamTarget:function(a,b,c,d){0!=d?a.setTargetAtTime(b,c,d):a.setValueAtTime(b,c)},releaseAllNote:function(){t=this.actx.currentTime+.1;for(var a=this.notetab.length-1;a>=0;--a){for(var b=this.notetab[a],c=b.g.length-1;c>=0;--c)b.g[c].gain.cancelScheduledValues(t),b.g[c].gain.setValueAtTime(0,t);b.f=1,b.e=t}},releaseNote:function(a,b){for(var c=a.g.length-1;c>=0;--c)a.g[c].gain.cancelScheduledValues(b),b<=a.t2&&(b==a.t2?a.g[c].gain.setValueAtTime(a.v[c],b):a.g[c].gain.setValueAtTime(a.v[c]*(b-a.t)/(a.t2-a.t),b)),this.setParamTarget(a.g[c].gain,0,b,a.r[c]);a.e=b+10*a.r[0],a.f=1},sustainState:function(a,b,c){if(this.sustain[a]=b,b<64)for(var d=this.notetab.length-1;d>=0;--d){var e=this.notetab[d];c>=e.t&&e.ch==a&&1==e.f&&this.releaseNote(e,c)}},resetAllController:function(a){this.bend[a]=0,this.vol[a]=.62000124000248,this.ex[a]=1,this.brange[a]=256,this.rpnidx[a]=16383,this.sustain[a]=0,this.chvol[a].gain.value=this.vol[a]*this.ex[a],this.chmod[a].gain.value=0,this.chpan[a].pan.value=0,this.pg[a]=0},send:function(a,b,c){var d;void 0===c&&(c=this.tsmode),c&&(b=.001*b-this.tsdiff);var e=15&a[0],f=a[0]&-16;if(!(f<128||f>=256))switch(144==f&&0==a[2]&&(f=128),(!b||b<0)&&(b=0,this.actx&&(b=this.actx.currentTime)),f){case 176:switch(a[1]){case 1:this.chmod[e].gain.setValueAtTime(100*a[2]/127,b);break;case 7:this.vol[e]=a[2]*a[2]/16129,this.chvol[e].gain.setValueAtTime(this.vol[e]*this.ex[e],b);break;case 10:this.chpan[e].pan.setValueAtTime((a[2]-64)/64,b);break;case 11:this.ex[e]=a[2]*a[2]/16129,this.chvol[e].gain.setValueAtTime(this.vol[e]*this.ex[e],b);break;case 64:this.sustainState(e,a[2],b);break;case 98:case 98:this.rpnidx[e]=16383;break;case 100:this.rpnidx[e]=896&this.rpnidx[e]|a[2];break;case 101:this.rpnidx[e]=127&this.rpnidx[e]|a[2]<<7;break;case 6:0==this.rpnidx[e]&&(this.brange[e]=(a[2]<<7)+(127&this.brange[e]));break;case 38:0==this.rpnidx[e]&&(this.brange[e]=896&this.brange[e]|a[2]);break;case 120:case 123:case 124:case 125:case 126:case 127:b=this.actx.currentTime;for(var d=this.notetab.length-1;d>=0;--d){for(var g=this.notetab[d],h=g.g.length-1;h>=0;--h)g.g[h].gain.cancelScheduledValues(0),g.g[h].gain.setValueAtTime(0,b),g.g[h].disconnect();for(var h=g.o.length-1;h>=0;--h)g.o[h].disconnect(),g.o[h].frequency.cancelScheduledValues(0),g.o[h].stop();g.e=b+.1,this.notetab.splice(d,1)}for(var d=0;d<16;++d)this.chmod[d].disconnect();break;case 121:for(var d=0;d<16;++d)this.resetAllController(d)}break;case 192:this.pg[e]=a[1];break;case 224:var i=100*this.brange[e]/127;this.bend[e]=(a[1]+(a[2]<<7)-8192)*i/8192;for(var d=this.notetab.length-1;d>=0;--d){var g=this.notetab[d];if(g.ch==e)for(var j=g.o.length-1;j>=0;--j)g.o[j].detune.setValueAtTime(this.bend[e],b)}break;case 144:if(this.canvas&&(this.ctx.fillStyle="#f00",this.ctx.globalCompositeOperation="lighter",this.ctx.fillRect(240,62-4*e,10,3)),
9==e)return void(a[1]>=35&&a[1]<=81&&this.note(b,e,a[1],a[2],this.drummap[a[1]-35].p));this.note(b,e,a[1],a[2],this.program[this.pg[e]].p);break;case 128:for(var d=this.notetab.length-1;d>=0;--d){var g=this.notetab[d];b>=g.t&&g.ch==e&&g.n==a[1]&&0==g.f&&(g.f=1,this.sustain[e]<64&&this.releaseNote(g,b))}}},createWave:function(a){for(var b=0;b<a.length;++b)for(var c=a[b],d=0;c&&d<c.length;++d){var e=c[d].w;if("w"==e[0]&&!this.wave[e]){for(var f=new Float32Array(e.length),g=new Float32Array(e.length),b=1;b<e.length;++b)f[b]=e[b];this.wave[e]=this.actx.createPeriodicWave(g,f)}}},setAudioContext:function(a,b){this.audioContext=this.actx=a,this.dest=b,b||(this.dest=a.destination),this.tsdiff=.001*performance.now()-this.actx.currentTime,console.log("TSDiff:"+this.tsdiff),this.conv=this.actx.createConvolver(),this.rev=this.actx.createGain(),this.comp=this.actx.createDynamicsCompressor(),this.rev.gain.value=this.reverbLev,this.out=this.actx.createGain(),this.setMasterVol(),this.out.connect(this.conv),this.out.connect(this.comp),this.conv.connect(this.rev),this.rev.connect(this.comp),this.comp.connect(this.dest);var c=.5*this.actx.sampleRate|0;this.convBuf=this.actx.createBuffer(2,c,this.actx.sampleRate),this.noiseBuf=this.actx.createBuffer(1,c,this.actx.sampleRate);var d=this.convBuf.getChannelData(0),e=this.convBuf.getChannelData(1);for(i=0;i<c;++i)i/c<Math.random()&&(d[i]=Math.exp(-3*i/c)*(Math.random()-.5),e[i]=Math.exp(-3*i/c)*(Math.random()-.5));for(this.conv.buffer=this.convBuf,this.chvol=[],this.chmod=[],this.chpan=[],this.wave={},this.createWave(this.program0),this.createWave(this.program1),this.createWave(this.drummap0),this.createWave(this.drummap1),this.lfo=this.actx.createOscillator(),this.lfo.frequency.value=5,this.lfo.start(),i=0;i<16;++i)this.chvol[i]=this.actx.createGain(),this.chpan[i]=this.actx.createStereoPanner(),this.chvol[i].connect(this.chpan[i]),this.chpan[i].connect(this.out),this.chmod[i]=this.actx.createGain(),this.lfo.connect(this.chmod[i]),this.pg[i]=i,this.resetAllController(i);this.graph>=1&&(this.ana=this.actx.createAnalyser(),this.out.connect(this.ana)),this.setReverbLev(),this.send([144,60,1]),this.send([144,60,0])}},this.setQuality=function(a){this.sy.setQuality(a)},this.setReverbLev=function(a){this.sy.setReverbLev(a)},this.setMasterVol=function(a){this.sy.setMasterVol(a)},this.setLoop=function(a){this.sy.setLoop(a)},this.getTimbreName=function(a,b){return this.sy.getTimbreName(a,b)},this.send=function(a,b,c){this.sy.send(a,b,c)},this.loadMIDIUrl=function(a){this.sy.loadMIDIUrl(a)},this.loadMIDI=function(a){this.sy.loadMIDI(a)},this.playMIDI=function(){this.sy.playMIDI()},this.stopMIDI=function(){this.sy.stopMIDI()},this.getPlayStatus=function(){return this.sy.getPlayStatus()};for(var a in this.sy.properties)this.sy[a]=this.sy.properties[a].value;this.setQuality(1),this.sy.ready()}